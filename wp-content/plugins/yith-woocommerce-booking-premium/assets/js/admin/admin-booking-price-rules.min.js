jQuery(function(s){"use strict";var t=wp.i18n.__,c={lastIndex:1,rulesContainer:!1,rulesList:!1,productData:s("#woocommerce-product-data"),preNewRuleContainer:s("#yith-wcbk-price-rules__pre-new-rule"),expandCollapseButton:s(".yith-wcbk-price-rules__expand-collapse"),saveSettingsButton:s("#yith-wcbk-settings-tab-actions-save"),templates:{rule:wp.template("yith-wcbk-price-rule")},ruleToAdd:!1,addRuleModal:!1,init:function(){this._initParams(),s(document).on("change yith_wcbk_admin_booking_price_rule_condition_type_change",".yith-wcbk-price-rule__condition__type",this.conditionTypeChanged),s(".yith-wcbk-price-rules__new-rule").on("click",this.openAddRuleModal),s(document).on("click",".yith-wcbk-price-rules__add-rule",this.addRule),s(document).on("click",".yith-wcbk-price-rules__delete-rule",this.deleteRule),s(document).on("click",".yith-wcbk-price-rule__conditions__new-condition",this.addCondition),s(document).on("click",".yith-wcbk-price-rule__condition__delete-condition",this.deleteCondition),this.expandCollapseButton.on("click",this.expandCollapseAll),this.checkConditionVisibility(),this.expandCollapseVisibility(),this.checkIfHasRules()},_initParams:function(){this.rulesContainer=s(".yith-wcbk-price-rules").first(),this.rulesList=this.rulesContainer.find(".yith-wcbk-price-rules__list"),this.lastIndex=this.rulesList.find(".yith-wcbk-price-rule").length||0},nextIndex:function(){return++c.lastIndex},checkConditionVisibility:function(e){(e=(e=e||s(".yith-wcbk-price-rule__condition__type")).is(".yith-wcbk-price-rule")||e.is(".yith-wcbk-price-rule__condition")?e.find(".yith-wcbk-price-rule__condition__type"):e).trigger("yith_wcbk_admin_booking_price_rule_condition_type_change")},conditionTypeChanged:function(e){var i,t,e=s(e.target),n=e.val()||"custom",e=e.closest(".yith-wcbk-price-rule__condition"),c={custom:e.find(".yith-wcbk-price-rule__condition--show-if-custom"),month:e.find(".yith-wcbk-price-rule__condition--show-if-month"),week:e.find(".yith-wcbk-price-rule__condition--show-if-week"),day:e.find(".yith-wcbk-price-rule__condition--show-if-day"),time:e.find(".yith-wcbk-price-rule__condition--show-if-time input"),numeric:e.find(".yith-wcbk-price-rule__condition--show-if-numeric")},o=["custom","month","week","day","time","numeric"],l=function(e,i){return-1!==s.inArray(e,i)};if(l(n,["custom","month","week","day","time","numeric"])){for(i in o)n!==(t=o[i])&&(c[t].attr("disabled","disabled"),(l(t,["custom","time"])?c[t].parent():c[t]).hide());c[n].removeAttr("disabled"),(l(n,["custom","time"])?c[n].parent():c[n]).show()}else c.custom.attr("disabled","disabled"),c.month.attr("disabled","disabled"),c.week.attr("disabled","disabled"),c.day.attr("disabled","disabled"),c.time.attr("disabled","disabled"),c.custom.parent().hide(),c.month.hide(),c.week.hide(),c.day.hide(),c.time.parent().hide(),c.numeric.removeAttr("disabled"),c.numeric.show()},checkIfHasRules:function(){c.rulesList.find(".yith-wcbk-price-rule").length?c.rulesContainer.addClass("yith-wcbk-price-rules--has-rules"):c.rulesContainer.removeClass("yith-wcbk-price-rules--has-rules")},getRuleToAdd:function(){return c.ruleToAdd},getBookingClasses:function(){return c.productData.attr("class").split(/\s+/).filter(function(e){return 0===e.search("bk_")})},openAddRuleModal:function(e){var i;e.preventDefault(),c.getRuleToAdd()||(e=c.nextIndex(),i=["yith-wcbk-price-rules__create-modal"].concat(c.getBookingClasses()).join(" "),c.ruleToAdd=s(c.templates.rule({ruleIndex:e})),c.addRuleModal=yith.ui.modal({title:t("Create rule","yith-booking-for-woocommerce"),classes:{main:i},content:c.ruleToAdd,width:1024,onClose:function(){c.ruleToAdd=!1},onCreate:function(){c.ruleToAdd.find(".yith-wcbk-admin-date-picker").yith_wcbk_datepicker(),n.initOperators(c.ruleToAdd),o.initVisibility(c.ruleToAdd),c.checkConditionVisibility(c.ruleToAdd),s(document).trigger("yith_wcbk_product_metabox_dynamic_durations"),c.ruleToAdd.find(".yith-wcbk-price-rule__title-field").focus()}}))},addRule:function(e){e.preventDefault();e=s(this).closest(".yith-wcbk-price-rule");e.find(".yith-wcbk-price-rules__add-rule").remove(),c.rulesList.append(e),c.addRuleModal&&c.addRuleModal.close(),c.addRuleModal=!1,c.expandCollapseVisibility(),c.attentionForSaving(),c.checkIfHasRules()},deleteRule:function(e){e.preventDefault(),s(e.target).closest(".yith-wcbk-price-rule").animate({opacity:.3},200).delay(200).slideUp(300,function(){s(this).remove(),c.expandCollapseVisibility(),c.attentionForSaving(),c.checkIfHasRules()})},addCondition:function(e){e.preventDefault();var e=s(e.target),i=wp.template("yith-wcbk-price-rule-condition"),t=e.closest(".yith-wcbk-price-rule__conditions").find(".yith-wcbk-price-rule__conditions__list"),e=e.closest(".yith-wcbk-price-rule").data("index")||1,n=1;t.data("last-index")?n=t.data("last-index")+1:(n=t.find(".yith-wcbk-price-rule__condition").length||0,n+=1),t.data("last-index",n),e=s(i({ruleIndex:e,conditionIndex:n})),t.append(e),e.find(".yith-wcbk-admin-date-picker").yith_wcbk_datepicker(),c.checkConditionVisibility(e)},deleteCondition:function(e){e.preventDefault(),s(e.target).closest(".yith-wcbk-price-rule__condition").remove()},expandCollapseAll:function(e){var e=s(e.target).closest(".yith-wcbk-price-rules__expand-collapse"),i=c.rulesList;(e.is(".yith-wcbk-price-rules__expand-collapse--collapse")?(e.removeClass("yith-wcbk-price-rules__expand-collapse--collapse"),i.find(".yith-wcbk-settings-section-box:not(.yith-wcbk-settings-section-box--closed) .yith-wcbk-settings-section-box__toggle")):(e.addClass("yith-wcbk-price-rules__expand-collapse--collapse"),i.find(".yith-wcbk-settings-section-box.yith-wcbk-settings-section-box--closed .yith-wcbk-settings-section-box__toggle"))).click()},expandCollapseVisibility:function(){c.rulesList.find(".yith-wcbk-price-rule").length?c.expandCollapseButton.show():c.expandCollapseButton.hide()},attentionForSaving:function(){c.saveSettingsButton.length&&(c.saveSettingsButton.removeClass("yith-wcbk-effect--wiggle"),c.saveSettingsButton.outerWidth(),c.saveSettingsButton.addClass("yith-wcbk-effect--wiggle"))}},n=(c.init(),{init:function(){s(document).on("change",".yith-wcbk-operator-and-amount-fields__operator",this.handleOperatorChange),this.initOperators()},initOperators:function(e){(e=void 0!==e?e:s(document)).find(".yith-wcbk-operator-and-amount-fields__operator").each(function(){n.handleOperatorChange.call(s(this))})},handleOperatorChange:function(){var e=s(this).closest(".yith-wcbk-operator-and-amount-fields"),i=e.data("currency-symbol"),e=e.find(".yith-wcbk-operator-and-amount-fields__symbol"),t=s(this).val();["add","sub","set-to"].includes(t)?e.html(i):["add-percentage","sub-percentage"].includes(t)?e.html("%"):e.html("")}}),o=(n.init(),{init:function(){var e=this;s(document).on("change",".yith-wcbk-price-rule__base-fee-enabled input",e.toggleBaseFee),s(document).on("change",".yith-wcbk-price-rule__base-price-enabled input",e.toggleBasePrice),e.initVisibility()},initVisibility:function(e){(e=void 0!==e?e:s(document)).find(".yith-wcbk-price-rule__base-fee-enabled input").each(function(){o.toggleBaseFee.call(s(this))}),e.find(".yith-wcbk-price-rule__base-price-enabled input").each(function(){o.toggleBasePrice.call(s(this))})},_togglePrice:function(e,i){var i=e.closest(".yith-wcbk-price-rule").find(i),t=i.find("input, select");"yes"===e.val()?(t.prop("disabled",!1),i.show()):(t.prop("disabled",!0),i.hide())},toggleBaseFee:function(){o._togglePrice(s(this),".yith-wcbk-price-rule__base-fee-fields")},toggleBasePrice:function(){o._togglePrice(s(this),".yith-wcbk-price-rule__base-price-fields")}});o.init()});
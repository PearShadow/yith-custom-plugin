!function(d,e){"use strict";var t=e.i18n.__,a=function(){d(document.body).trigger("wc-enhanced-select-init")},l={dom:{productData:d("#woocommerce-product-data"),rulesContainer:d(".yith-wcbk-availability-rules").first(),blankState:d(".yith-wcbk-availability-rules__blank-state"),rulesList:!1,newRuleButton:d(".yith-wcbk-availability-rules__new-rule"),expandCollapseButton:d(".yith-wcbk-availability-rules__expand-collapse"),saveSettingsButton:d("#yith-wcbk-settings-tab-actions-save"),form:d("form#post, form#yith-wcbk-global-availability")},ruleToAdd:!1,addRuleModal:!1,indexes:{rules:1,dataRanges:1},templates:{rule:e.template("yith-wcbk-availability-rule")},hasTime:!1,_initParams:function(){this.dom.rulesList=this.dom.rulesContainer.find(".yith-wcbk-availability-rules__list"),this.indexes.rules=this.dom.rulesList.find(".yith-wcbk-availability-rule").length||0},init:function(){this._initParams(),d(document).on("change yith_wcbk_admin_booking_availability_rule_type_change",".yith-wcbk-availability-rule__type",this.handleTypeChange),this.dom.newRuleButton.on("click",this.openAddRuleModal),d(document).on("click",".yith-wcbk-availability-rule__add-rule",this.addRule),d(document).on("click",".yith-wcbk-availability-rule__delete-rule",this.deleteRule),this.dom.expandCollapseButton.on("click",this.expandCollapseAll),this.expandCollapseVisibility(),d(".yith-wcbk-availability-rule__type").each(function(){l.handleTypeChange.call(d(this))}),this.checkIfHasRules()},checkIfHasRules:function(){l.dom.rulesList.find(".yith-wcbk-availability-rule").length?l.dom.rulesContainer.addClass("yith-wcbk-availability-rules--has-rules"):l.dom.rulesContainer.removeClass("yith-wcbk-availability-rules--has-rules")},handleTypeChange:function(){var i=d(this).val(),e=d(this).closest(".yith-wcbk-availability-rule"),t=e.find(".bk_ar_enable_if_type_specific"),a=t.find("input, select, textarea"),l=e.find(".bk_ar_enable_if_type_generic"),n=l.find("input, select, textarea");"specific"===i?(t.prop("disabled",!1),a.prop("disabled",!1),l.attr("disabled","disabled"),n.attr("disabled","disabled"),e.removeClass("yith-wcbk-availability-rule--generic-type").addClass("yith-wcbk-availability-rule--specific-type")):(l.prop("disabled",!1),n.prop("disabled",!1),t.attr("disabled","disabled"),a.attr("disabled","disabled"),e.removeClass("yith-wcbk-availability-rule--specific-type").addClass("yith-wcbk-availability-rule--generic-type"))},getRuleToAdd:function(){return l.ruleToAdd},getBookingClasses:function(){return l.dom.productData.length?l.dom.productData.attr("class").split(/\s+/).filter(function(i){return 0===i.search("bk_")}):""},openAddRuleModal:function(i){var e;i.preventDefault(),l.getRuleToAdd()||(i=l.nextIndex(),e=["yith-wcbk-availability-rules__create-modal"].concat(l.getBookingClasses()).join(" "),l.ruleToAdd=d(l.templates.rule({ruleIndex:i})),l.addRuleModal=yith.ui.modal({title:t("Create rule","yith-booking-for-woocommerce"),classes:{main:e},content:l.ruleToAdd,width:1024,onClose:function(){l.ruleToAdd=!1},onCreate:function(){l.ruleToAdd.find(".yith-wcbk-admin-date-picker").yith_wcbk_datepicker(),a(),l.handleTypeChange.call(l.ruleToAdd.find(".yith-wcbk-availability-rule__type")),l.ruleToAdd.find(".yith-wcbk-availability-rule__title-field").focus()}}))},addRule:function(i){i.preventDefault();i=d(this).closest(".yith-wcbk-availability-rule");i.find(".yith-wcbk-availability-rules__add-rule").remove(),l.dom.rulesList.append(i),l.addRuleModal&&l.addRuleModal.close(),l.addRuleModal=!1,l.expandCollapseVisibility(),l.attentionForSaving(),l.checkIfHasRules()},deleteRule:function(i){i.preventDefault(),d(i.target).closest(".yith-wcbk-availability-rule").animate({opacity:.3},200).delay(200).slideUp(300,function(){d(this).remove(),l.expandCollapseVisibility(),l.attentionForSaving(),l.checkIfHasRules()})},nextIndex:function(){return++l.indexes.rules},expandCollapseAll:function(i){var i=d(i.target).closest(".yith-wcbk-availability-rules__expand-collapse"),e=l.dom.rulesList;(i.is(".yith-wcbk-availability-rules__expand-collapse--collapse")?(i.removeClass("yith-wcbk-availability-rules__expand-collapse--collapse"),e.find(".yith-wcbk-settings-section-box:not(.yith-wcbk-settings-section-box--closed) .yith-wcbk-settings-section-box__toggle")):(i.addClass("yith-wcbk-availability-rules__expand-collapse--collapse"),e.find(".yith-wcbk-settings-section-box.yith-wcbk-settings-section-box--closed .yith-wcbk-settings-section-box__toggle"))).click()},expandCollapseVisibility:function(){l.dom.rulesList.find(".yith-wcbk-availability-rule").length?l.dom.expandCollapseButton.show():l.dom.expandCollapseButton.hide()},attentionForSaving:function(){l.dom.saveSettingsButton.length&&(l.dom.saveSettingsButton.removeClass("yith-wcbk-effect--wiggle"),l.dom.saveSettingsButton.outerWidth(),l.dom.saveSettingsButton.addClass("yith-wcbk-effect--wiggle"))}},i=(l.init(),function(o){var i={template:"",selectors:{main:!1,wrap:!1,list:!1,row:!1,add:!1,remove:!1},indexes:{main:"ruleIndex",row:"availabilityIndex"},filterNewRowData:!1,onAddRow:!1,beforeDeleteRow:!1,onDeleteRow:!1},a=((o=d.extend({},i,o)).selectors=d.extend({},i.selectors,o.selectors),o.indexes=d.extend({},i.indexes,o.indexes),{});a.template=e.template(o.template),a._init=function(){d(document).on("click",o.selectors.add,a.addRow),d(document).on("click",o.selectors.remove,a.deleteRow)},a.getRelatedData=function(i){var i=i.target?d(i.target):d(i),e=!!o.selectors.main&&i.closest(o.selectors.main),i=e?e.find(o.selectors.wrap):i.closest(o.selectors.wrap),t=i.find(o.selectors.list),a=t.find(o.selectors.row),l=Math.max.apply(null,a.get().map(function(i){return parseInt(d(i).data("index"),10)})),n={},l=(e&&(n[o.indexes.main]=e.data("index")),n[o.indexes.row]=l+1,{main:e,wrap:i,list:t,rows:a,add:i.find(o.selectors.add)});return{dom:l,newRowData:n="function"==typeof o.filterNewRowData?o.filterNewRowData(d.extend({},n),d.extend({},l)):n}},a.addRow=function(i){var i=a.getRelatedData(i),e=d(a.template(i.newRowData));i.dom.list.append(e),"function"==typeof o.onAddRow&&o.onAddRow(e,a.getRelatedData(e))},a.deleteRow=function(i){var e=!0,t=d(this).closest(o.selectors.row),i=a.getRelatedData(i);(e="function"==typeof o.beforeDeleteRow?o.beforeDeleteRow(t,i):e)&&(t.remove(),"function"==typeof o.onDeleteRow)&&o.onDeleteRow(t,a.getRelatedData(i.dom.wrap))},a._init()}),n=function(i,e){a();var t=i.find(".yith-wcbk-availability__day"),e=(t.val("").trigger("change"),8<=e.dom.rows.length&&e.dom.add.hide(),t.find("option:not(:disabled)").first().val()||!1);e?t.val(e).trigger("change"):i.remove()},o=function(i,e){e.dom.rows.first().find(".yith-wcbk-availability__day").trigger("change"),e.dom.add.show()};i({template:"yith-wcbk-availability-rule-date-range",selectors:{main:".yith-wcbk-availability-rule",wrap:".yith-wcbk-availability-rule__date-ranges",list:".yith-wcbk-availability-rule__date-ranges__list",row:".yith-wcbk-availability-rule__date-range",add:".yith-wcbk-availability-rule__date-ranges__add-range",remove:".yith-wcbk-availability-rule__date-range__action--delete"},indexes:{main:"ruleIndex",row:"dateRangeIndex"},onAddRow:function(i,e){l.handleTypeChange.call(e.dom.main.find(".yith-wcbk-availability-rule__type")),i.find(".yith-wcbk-admin-date-picker").yith_wcbk_datepicker(),a()}}),i({template:"yith-wcbk-availability-rule-availability",selectors:{main:".yith-wcbk-availability-rule",wrap:".yith-wcbk-availability-rule__availabilities",list:".yith-wcbk-availability-rule__availabilities__list",row:".yith-wcbk-availability-rule__availability",add:".yith-wcbk-availability-rule__availabilities__add-availability",remove:".yith-wcbk-availability-rule__availability__action--delete"},indexes:{main:"ruleIndex",row:"availabilityIndex"},onAddRow:n,onDeleteRow:o,beforeDeleteRow:function(i,e){return"all-day"===i.find(".yith-wcbk-availability__full-day-type").val()}}),i({template:"yith-wcbk-availability-rule-availability-time-slot",selectors:{main:".yith-wcbk-availability-rule__availability",wrap:".yith-wcbk-availability__time-slots",list:".yith-wcbk-availability__time-slots__list",row:".yith-wcbk-availability__time-slot",add:".yith-wcbk-availability-rule__availability__time-slots__add-time-slot",remove:".yith-wcbk-availability-rule__availability__time-slot__action--delete"},indexes:{main:"availabilityIndex",row:"timeSlotIndex"},onAddRow:function(){a()},filterNewRowData:function(i,e){return i.ruleIndex=e.main.closest(".yith-wcbk-availability-rule").data("index"),i},beforeDeleteRow:function(i,e){return!(e.dom.rows.length<2&&(e.dom.main.find(".yith-wcbk-availability__full-day-type").val("all-day").trigger("change"),1))}}),{init:function(){d(document).on("change",".yith-wcbk-availability__full-day-type",this.fullDayTypeChangeHandler),d(document).on("change",".yith-wcbk-availability__day",this.dayChangeHandler)},fullDayTypeChangeHandler:function(){var i=d(this).closest(".yith-wcbk-availability"),e=i.find(".yith-wcbk-availability__time-slots"),t=e.find(".yith-wcbk-availability__time-slots__list").find("input"),a=d(this).val();i.attr("data-full-day-type",a),"all-day"===a?(e.hide(),t.prop("disabled",!0)):(e.show(),t.prop("disabled",!1))},dayChangeHandler:function(){var i=d(this).closest(".yith-wcbk-availability").parent().find(".yith-wcbk-availability__day"),a=i.map(function(){return d(this).val()}).toArray();i.each(function(){var e=d(this).val(),t=a.filter(function(i){return i!==e}),i=d(this).find("option");i.prop("disabled",!1),i.each(function(){var i=d(this);0<=t.indexOf(i.val())&&i.prop("disabled",!0)})})}}.init(),i({template:"yith-wcbk-default-availability",selectors:{main:!1,wrap:".yith-wcbk-default-availabilities",list:".yith-wcbk-default-availabilities__list",row:".yith-wcbk-default-availabilities__availability",add:".yith-wcbk-default-availabilities__actions__add-availability",remove:".yith-wcbk-default-availabilities__availability__action--delete"},indexes:{row:"availabilityIndex"},onAddRow:n,onDeleteRow:o,beforeDeleteRow:function(i,e){return"all-day"===i.find(".yith-wcbk-availability__full-day-type").val()}}),i({template:"yith-wcbk-default-availability-time-slot",selectors:{main:".yith-wcbk-availability",wrap:".yith-wcbk-availability__time-slots",list:".yith-wcbk-availability__time-slots__list",row:".yith-wcbk-availability__time-slot",add:".yith-wcbk-default-availabilities__availability__time-slots__add-time-slot",remove:".yith-wcbk-default-availabilities__availability__time-slot__action--delete"},indexes:{main:"availabilityIndex",row:"timeSlotIndex"},onAddRow:function(){a()},beforeDeleteRow:function(i,e){return!(e.dom.rows.length<2&&(e.dom.main.find(".yith-wcbk-availability__full-day-type").val("all-day").trigger("change"),1))}})}(jQuery,wp);